# Python ç¨‹å¼ç¢¼çµæ§‹åˆ†æ

## ğŸ“ Python æ¨¡çµ„ç¸½è¦½

### ä¸»è¦æ¨¡çµ„çµæ§‹
```
src/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ simulation/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ multint.py              # ä¸»è¦æ¨¡æ“¬æ§åˆ¶å™¨
â”œâ”€â”€ physics/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ poisson.py          # Poisson æ–¹ç¨‹æ±‚è§£å™¨
â”‚   â”‚   â”œâ”€â”€ charge_density.py   # é›»è·å¯†åº¦è¨ˆç®—
â”‚   â”‚   â”œâ”€â”€ potential.py        # é›»ä½ç›¸é—œè¨ˆç®—
â”‚   â”‚   â””â”€â”€ schrodinger.py      # SchrÃ¶dinger æ–¹ç¨‹æ±‚è§£
â”‚   â”œâ”€â”€ materials/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ semiconductor.py    # åŠå°é«”ææ–™
â”‚   â”‚   â”œâ”€â”€ tip.py              # STM æ¢é‡
â”‚   â”‚   â””â”€â”€ surface_states.py   # è¡¨é¢æ…‹
â”‚   â”œâ”€â”€ solvers/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ grid.py             # ç¶²æ ¼æ±‚è§£å™¨
â”‚   â””â”€â”€ visualization/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ plotter.py          # çµæœç¹ªåœ–
â”‚       â””â”€â”€ contour.py          # ç­‰é«˜ç·šåœ–
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py               # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ file_handler.py         # æª”æ¡ˆè™•ç†
â””â”€â”€ utils/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ constants.py            # ç‰©ç†å¸¸æ•¸
```

## ğŸ” å„æ¨¡çµ„è©³ç´°åˆ†æ

### 1. simulation/multint.py (ä¸»æ§åˆ¶å™¨)

#### åŸºæœ¬è³‡è¨Š
- **å°æ‡‰ Fortran**: MultInt3-6.4.f
- **è¡Œæ•¸**: ~500 è¡Œ
- **è¨­è¨ˆæ¨¡å¼**: ç‰©ä»¶å°å‘ï¼Œå–®ä¸€è·è²¬

#### é¡åˆ¥çµæ§‹
```python
class MultIntSimulation:
    â”œâ”€â”€ __init__()              # åˆå§‹åŒ–
    â”œâ”€â”€ run()                   # ä¸»åŸ·è¡Œå‡½æ•¸
    â”œâ”€â”€ _setup_simulation()     # æ¨¡æ“¬è¨­å®š
    â”œâ”€â”€ _voltage_scan_loop()    # é›»å£“æƒæè¿´åœˆ
    â”œâ”€â”€ _compute_charge_tables() # é›»è·å¯†åº¦è¡¨æ ¼
    â”œâ”€â”€ _solve_poisson()        # Poisson æ±‚è§£
    â”œâ”€â”€ _calculate_current()    # é›»æµè¨ˆç®—
    â””â”€â”€ _save_results()         # çµæœå„²å­˜
```

#### é—œéµæ–¹æ³•å°æ‡‰
| Python æ–¹æ³• | Fortran å°æ‡‰ | ç‹€æ…‹ |
|-------------|-------------|------|
| `_setup_simulation()` | åˆå§‹åŒ–éƒ¨åˆ† | âœ… |
| `_voltage_scan_loop()` | ä¸»è¿´åœˆ | âœ… |
| `_solve_poisson()` | CALL SEMITIP3 | âš ï¸ |
| `_calculate_current()` | CALL INTCURR | âŒ |

### 2. physics/core/poisson.py (Poisson æ±‚è§£å™¨)

#### åŸºæœ¬è³‡è¨Š
- **å°æ‡‰ Fortran**: semitip3-6.1.f
- **è¡Œæ•¸**: ~400 è¡Œ
- **æ•¸å€¼æ–¹æ³•**: SOR è¿­ä»£æ³•

#### é¡åˆ¥çµæ§‹
```python
class PoissonSolver:
    â”œâ”€â”€ __init__()                    # åˆå§‹åŒ–ç¶²æ ¼
    â”œâ”€â”€ solve()                       # ä¸»æ±‚è§£å‡½æ•¸
    â”œâ”€â”€ _setup_grids()               # ç¶²æ ¼è¨­å®š
    â”œâ”€â”€ _set_boundary_conditions()   # é‚Šç•Œæ¢ä»¶
    â”œâ”€â”€ _sor_iteration()             # SOR è¿­ä»£
    â”œâ”€â”€ _check_convergence()         # æ”¶æ–‚æª¢æŸ¥
    â”œâ”€â”€ _multigrid_solve()           # å¤šç¶²æ ¼æ±‚è§£
    â””â”€â”€ _update_potential()          # é›»ä½æ›´æ–°
```

#### ç›®å‰å•é¡Œ
- **æ”¶æ–‚éå¿«**: è¿­ä»£æ¬¡æ•¸å›ºå®šç‚º 200ï¼Œæ‡‰è©²æ˜¯å‹•æ…‹æ”¶æ–‚
- **éç·šæ€§æ±‚è§£**: ç¼ºå°‘é¡ä¼¼ GSECT çš„éç·šæ€§è™•ç†
- **é‚Šç•Œæ¢ä»¶**: éœ€è¦æ›´ç²¾ç¢ºçš„é‚Šç•Œè™•ç†

### 3. physics/core/charge_density.py (é›»è·å¯†åº¦)

#### åŸºæœ¬è³‡è¨Š
- **å°æ‡‰ Fortran**: semirhomult-6.0.f, surfrhomult-6.2.f
- **è¡Œæ•¸**: ~300 è¡Œ
- **åŠŸèƒ½**: é›»è·å¯†åº¦æ’å€¼è¡¨å»ºç«‹

#### é¡åˆ¥çµæ§‹
```python
class ChargeDensityCalculator:
    â”œâ”€â”€ __init__()                      # åˆå§‹åŒ–
    â”œâ”€â”€ create_bulk_charge_table()      # é«”é›»è·å¯†åº¦è¡¨
    â”œâ”€â”€ create_surface_charge_table()   # è¡¨é¢é›»è·å¯†åº¦è¡¨
    â”œâ”€â”€ get_bulk_charge_density()       # é«”é›»è·å¯†åº¦æ’å€¼
    â”œâ”€â”€ get_surface_charge_density()    # è¡¨é¢é›»è·å¯†åº¦æ’å€¼
    â””â”€â”€ _setup_energy_range()           # èƒ½é‡ç¯„åœè¨­å®š
```

#### å¯¦ç¾ç‹€æ…‹
- âœ… **æ’å€¼è¡¨å»ºç«‹**: æ­£ç¢ºå¯¦ç¾
- âœ… **èƒ½é‡ç¯„åœ**: èˆ‡ Fortran ä¸€è‡´
- âœ… **æ’å€¼å‡½æ•¸**: å·¥ä½œæ­£å¸¸

### 4. physics/materials/semiconductor.py (åŠå°é«”)

#### åŸºæœ¬è³‡è¨Š
- **å°æ‡‰ Fortran**: COMMON/SEMI/ å€å¡Š
- **è¡Œæ•¸**: ~200 è¡Œ
- **åŠŸèƒ½**: åŠå°é«”ææ–™å±¬æ€§

#### é¡åˆ¥çµæ§‹
```python
class SemiconductorRegion:
    â”œâ”€â”€ __init__()                  # åˆå§‹åŒ–åƒæ•¸
    â”œâ”€â”€ calculate_fermi_level()     # è²»ç±³èƒ½éšè¨ˆç®—
    â”œâ”€â”€ get_carrier_density()       # è¼‰æµå­æ¿ƒåº¦
    â”œâ”€â”€ get_charge_density()        # é›»è·å¯†åº¦
    â””â”€â”€ get_band_properties()       # èƒ½å¸¶å±¬æ€§
```

### 5. physics/materials/tip.py (STM æ¢é‡)

#### åŸºæœ¬è³‡è¨Š
- **å°æ‡‰ Fortran**: æ¢é‡ç›¸é—œè®Šæ•¸
- **è¡Œæ•¸**: ~100 è¡Œ
- **é—œéµä¿®å¾©**: Tip potential å‹•æ…‹æ›´æ–°

#### é¡åˆ¥çµæ§‹
```python
class Tip:
    â”œâ”€â”€ __init__()                  # åˆå§‹åŒ–
    â”œâ”€â”€ tip_potential (property)    # æ¢é‡é›»ä½ (å‹•æ…‹)
    â”œâ”€â”€ update_bias()              # æ›´æ–°åå£“
    â””â”€â”€ get_geometry()             # å¹¾ä½•åƒæ•¸
```

#### é‡è¦ä¿®å¾©
```python
@property
def tip_potential(self):
    """Dynamic tip potential calculation"""
    return self.bias_voltage + self.contact_potential
```

### 6. physics/materials/surface_states.py (è¡¨é¢æ…‹)

#### åŸºæœ¬è³‡è¨Š
- **å°æ‡‰ Fortran**: surfrhomult-6.2.f éƒ¨åˆ†
- **è¡Œæ•¸**: ~150 è¡Œ
- **åŠŸèƒ½**: è¡¨é¢æ…‹åˆ†ä½ˆè¨ˆç®—

### 7. physics/core/schrodinger.py (SchrÃ¶dinger æ±‚è§£)

#### åŸºæœ¬è³‡è¨Š
- **å°æ‡‰ Fortran**: intcurr-6.2.f
- **è¡Œæ•¸**: ~200 è¡Œ
- **ç‹€æ…‹**: âš ï¸ éƒ¨åˆ†å¯¦ç¾

#### ç›®å‰å•é¡Œ
- **é›»æµè¨ˆç®—**: å‡ºç¾ NaN å€¼
- **å±€åŸŸåŒ–æ…‹**: æœå°‹ä¸å®Œæ•´
- **ç©åˆ†æ–¹æ³•**: éœ€è¦å®Œå–„

## ğŸ“Š æ¶æ§‹æ¯”è¼ƒ

### Fortran vs Python è¨­è¨ˆæ¨¡å¼

| ç‰¹æ€§ | Fortran | Python |
|------|---------|--------|
| **çµæ§‹** | ç¨‹åºå¼ | ç‰©ä»¶å°å‘ |
| **è³‡æ–™å…±äº«** | COMMON å€å¡Š | é¡åˆ¥å±¬æ€§ |
| **æ¨¡çµ„åŒ–** | å­ç¨‹åº | é¡åˆ¥/æ–¹æ³• |
| **é™£åˆ—ç´¢å¼•** | 1-based | 0-based |
| **è¨˜æ†¶é«”ç®¡ç†** | éœæ…‹é™£åˆ— | å‹•æ…‹é™£åˆ— |

### æ¨¡çµ„å°æ‡‰é—œä¿‚

```
Fortran æª”æ¡ˆ              Python æ¨¡çµ„
â”œâ”€â”€ MultInt3-6.4.f    â†’   simulation/multint.py
â”œâ”€â”€ semitip3-6.1.f    â†’   physics/core/poisson.py
â”œâ”€â”€ semirhomult-6.0.f â†’   physics/core/charge_density.py
â”œâ”€â”€ surfrhomult-6.2.f â†’   physics/materials/surface_states.py
â”œâ”€â”€ intcurr-6.2.f     â†’   physics/core/schrodinger.py
â”œâ”€â”€ potcut3-6.0.f     â†’   physics/core/potential.py
â”œâ”€â”€ potexpand-6.1.f   â†’   âŒ æœªå¯¦ç¾
â”œâ”€â”€ gsect-6.0.f       â†’   âš ï¸ åˆ†æ•£åœ¨å¤šå€‹æ¨¡çµ„
â””â”€â”€ contr3-6.0.f      â†’   âŒ æœªå¯¦ç¾
```

## ğŸ¯ å¯¦ç¾ç‹€æ…‹åˆ†æ

### âœ… å·²å®Œæˆæ¨¡çµ„
1. **simulation/multint.py**: ä¸»æ§é‚è¼¯ (80%)
2. **physics/core/charge_density.py**: é›»è·å¯†åº¦ (95%)
3. **physics/materials/semiconductor.py**: åŠå°é«” (90%)
4. **physics/materials/tip.py**: æ¢é‡ (85%)

### âš ï¸ éƒ¨åˆ†å®Œæˆæ¨¡çµ„
1. **physics/core/poisson.py**: Poisson æ±‚è§£ (60%)
   - ç¼ºå°‘éç·šæ€§æ±‚è§£
   - æ”¶æ–‚é‚è¼¯éœ€æ”¹é€²
2. **physics/core/schrodinger.py**: é›»æµè¨ˆç®— (30%)
   - å‡ºç¾ NaN å•é¡Œ
   - ç©åˆ†æ–¹æ³•ä¸å®Œæ•´

### âŒ æœªå¯¦ç¾åŠŸèƒ½
1. **potexpand-6.1.f**: é›»ä½å¤šæ¥µå±•é–‹
2. **contr3-6.0.f**: è¼”åŠ©æ§åˆ¶å‡½æ•¸
3. **gsect-6.0.f**: éç·šæ€§æ±‚æ ¹æ–¹æ³•

## ğŸ”§ è¨­è¨ˆæ¨¡å¼åˆ†æ

### å„ªé»
1. **æ¨¡çµ„åŒ–è¨­è¨ˆ**: æ¸…æ™°çš„é—œæ³¨é»åˆ†é›¢
2. **ç‰©ä»¶å°å‘**: å®¹æ˜“ç¶­è­·å’Œæ“´å±•
3. **å‹åˆ¥æç¤º**: å¢å¼·ä»£ç¢¼å¯è®€æ€§
4. **é…ç½®ç®¡ç†**: éˆæ´»çš„ YAML é…ç½®ç³»çµ±

### éœ€è¦æ”¹é€²
1. **æ•¸å€¼ç²¾åº¦**: ç¢ºä¿èˆ‡ Fortran ä¸€è‡´
2. **æ•ˆèƒ½æœ€ä½³åŒ–**: é—œéµè¿´åœˆçš„æœ€ä½³åŒ–
3. **éŒ¯èª¤è™•ç†**: æ›´å®Œå–„çš„ç•°å¸¸è™•ç†
4. **æ¸¬è©¦è¦†è“‹**: å¢åŠ å–®å…ƒæ¸¬è©¦

## ğŸ“ é—œéµç™¼ç¾

### æˆåŠŸç¿»è­¯çš„ç‰¹é»
1. **é…ç½®ç³»çµ±**: YAML vs Fortran è¼¸å…¥æª”æ¡ˆ
2. **è³‡æ–™çµæ§‹**: ç‰©ä»¶å±¬æ€§ vs COMMON å€å¡Š
3. **æ¨¡çµ„é‚Šç•Œ**: æ¸…æ™°çš„ä»‹é¢å®šç¾©

### ç¿»è­¯æŒ‘æˆ°
1. **æ•¸å€¼æ–¹æ³•**: è¤‡é›œç®—æ³•çš„ç²¾ç¢ºç§»æ¤
2. **è¨˜æ†¶é«”ä½ˆå±€**: å¤šç¶­é™£åˆ—çš„ç´¢å¼•è½‰æ›
3. **æ§åˆ¶æµç¨‹**: GOTO èªå¥çš„çµæ§‹åŒ–é‡å¯«

---

**åˆ†æå®Œæˆæ—¥æœŸ**: 2025-06-06  
**ä¸‹ä¸€æ­¥**: å»ºç«‹è©³ç´°çš„å‡½æ•¸å°æ‡‰é—œä¿‚
