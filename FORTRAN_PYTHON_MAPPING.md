# Fortran-Python ç¨‹å¼ç¢¼å°ç…§è¡¨

## æ¦‚è¿°
æœ¬æ–‡æª”è©³ç´°æ¯”è¼ƒ Fortran SEMITIP èˆ‡ Python å¯¦ç¾ï¼Œç¢ºä¿æ‰€æœ‰åŠŸèƒ½éƒ½æœ‰æ­£ç¢ºå°æ‡‰ã€‚

## ä¸»è¦æª”æ¡ˆå°ç…§

### 1. ä¸»ç¨‹åºçµæ§‹

| Fortran æª”æ¡ˆ | Python æª”æ¡ˆ | ç‹€æ…‹ | å‚™è¨» |
|-------------|-------------|------|------|
| MultInt3-6.4.f | src/simulation/multint.py | âœ… å®Œæˆ | ä¸»è¦æ¨¡æ“¬æµç¨‹ |
| semitip3-6.1.f | src/physics/core/poisson.py | âš ï¸ éœ€æª¢æŸ¥ | æ ¸å¿ƒ Poisson æ±‚è§£å™¨ |

### 2. æ ¸å¿ƒå­ç¨‹åºå°ç…§

#### A. ä¸»è¦æ¨¡æ“¬æµç¨‹ (MultInt3-6.4.f)

| Fortran å­ç¨‹åº/å€å¡Š | å°æ‡‰ Python å‡½æ•¸ | æª”æ¡ˆä½ç½® | ç‹€æ…‹ | é—œéµå·®ç•° |
|-------------------|-----------------|----------|------|----------|
| **ä¸»ç¨‹å¼åˆå§‹åŒ– (lines 1-100)** | `MultIntSimulation.__init__()` | multint.py:50-85 | âœ… | ç„¡ |
| **è®€å–åƒæ•¸ (lines 52-65)** | `YamlConfigReader.load_config()` | filereader.py | âœ… | YAML vs Fortranæ ¼å¼ |
| **ç¶²æ ¼åˆå§‹åŒ– (lines 90-120)** | `Grid3D.__init__()` | grid.py:80-150 | âš ï¸ | éœ€æª¢æŸ¥NVåƒæ•¸ |
| **èƒ½é‡ç¯„åœè¨ˆç®— (lines 342-351)** | `_calculate_energy_range()` | multint.py:463-530 | âœ… | é‚è¼¯åŒ¹é… |
| **é›»è·å¯†åº¦è¡¨æ ¼ (lines 355-380)** | `ChargeDensityTables.create_charge_tables()` | charge_density.py | âš ï¸ | éœ€è©³ç´°æª¢æŸ¥ |
| **å¤šç¶²æ ¼å¾ªç’° (lines 400-450)** | `_solve_single_bias()` | multint.py:242-380 | âœ… | é‚è¼¯åŒ¹é… |
| **é›»æµè¨ˆç®— (lines 500-600)** | æœªå®Œæ•´å¯¦ç¾ | - | âŒ ç¼ºå¤± | éœ€è¦å¯¦ç¾ |

#### B. Poisson æ±‚è§£å™¨ (semitip3-6.1.f)

| Fortran å­ç¨‹åº | å°æ‡‰ Python å‡½æ•¸ | æª”æ¡ˆä½ç½® | ç‹€æ…‹ | é—œéµåƒæ•¸æª¢æŸ¥ |
|---------------|-----------------|----------|------|-------------|
| **SEMITIP3 ä¸»ç¨‹åº** | `PoissonSolver.solve()` | poisson.py:176-287 | âœ… | - |
| **çœŸç©ºé›»ä½æ›´æ–° (lines 446-567)** | `_update_vacuum_fortran_style()` | poisson.py:289-350 | âš ï¸ | éœ€æª¢æŸ¥é‚Šç•Œæ¢ä»¶ |
| **ä»‹é¢é›»ä½æ›´æ–° (lines 578-622)** | `_update_interface_fortran_style()` | poisson.py:352-409 | âš ï¸ | EEPå¸¸æ•¸éœ€é©—è­‰ |
| **åŠå°é«”é›»ä½æ›´æ–° (lines 633-731)** | `_update_semiconductor_fortran_style()` | poisson.py:411-480 | âš ï¸ | å–®ä½è½‰æ›éœ€æª¢æŸ¥ |
| **åˆå§‹é›»ä½è¨­å®š (lines 170-206)** | `_set_initial_potential()` | poisson.py:482-523 | âœ… | IINIT=1é‚è¼¯æ­£ç¢º |
| **Band bendingè¨ˆç®— (PCENT)** | `get_band_bending()` | poisson.py:749-771 | âš ï¸ | æ¬Šé‡è¨ˆç®—éœ€é©—è­‰ |

#### C. é‡‘è‰²åˆ†å‰²æœç´¢ (GSECT)

| Fortran | Python | æª”æ¡ˆä½ç½® | ç‹€æ…‹ | å‚™è¨» |
|---------|--------|----------|------|------|
| **GSECT å­ç¨‹åº** | `golden_section_search()` | poisson.py:20-79 | âœ… | ç®—æ³•åŒ¹é… |
| **GSå¸¸æ•¸ 0.3819660** | `gs = 0.3819660` | poisson.py:45 | âœ… | æ•¸å€¼åŒ¹é… |

### 3. é—œéµå¸¸æ•¸å°ç…§

| é …ç›® | Fortran å€¼ | Python å€¼ | æª”æ¡ˆä½ç½® | ç‹€æ…‹ |
|------|-----------|-----------|----------|------|
| **EEPå¸¸æ•¸** | `1.80943E-20` | `1.80943e-20` | poisson.py:225 | âœ… |
| **é»ƒé‡‘åˆ†å‰²å¸¸æ•¸** | `0.3819660` | `0.3819660` | poisson.py:45 | âœ… |
| **GaAsä»‹é›»å¸¸æ•¸** | `12.9` | `12.9` | å¤šè™• | âœ… |
| **æº«åº¦** | `300.0` | `300.0` | config | âœ… |

### 4. æ•¸å€¼æ–¹æ³•å°ç…§

#### A. æœ‰é™å·®åˆ†æ ¼å¼

| å€åŸŸ | Fortran å¯¦ç¾ | Python å¯¦ç¾ | ç‹€æ…‹ | å‚™è¨» |
|------|-------------|-------------|------|------|
| **çœŸç©ºå€æ‹‰æ™®æ‹‰æ–¯ç®—å­** | semitip3 lines 500-520 | `_update_vacuum_fortran_style()` | âš ï¸ | éœ€æª¢æŸ¥ä¿‚æ•¸ |
| **åŠå°é«”å€æ³Šæ¾æ–¹ç¨‹** | semitip3 lines 650-700 | `_update_semiconductor_fortran_style()` | âš ï¸ | éœ€æª¢æŸ¥ä¿‚æ•¸ |
| **ä»‹é¢é‚Šç•Œæ¢ä»¶** | semitip3 lines 585-590 | `_update_interface_fortran_style()` | âš ï¸ | 3éšå·®åˆ†éœ€é©—è­‰ |

#### B. éç·šæ€§æ±‚è§£

| é …ç›® | Fortran | Python | ç‹€æ…‹ | éœ€æª¢æŸ¥ |
|------|---------|--------|------|--------|
| **è¡¨é¢é›»ä½æœç´¢ç¯„åœ** | `DELSURF = BIAS/1E6` | `delta_surf = bias/1e3` | âŒ | ç¯„åœä¸åŒ |
| **é«”é›»ä½æœç´¢ç¯„åœ** | `DELSEM = BIAS/1E6` | `delta_sem = bias/1e3` | âŒ | ç¯„åœä¸åŒ |
| **æ”¶æ–‚å®¹å¿åº¦** | éœ€å¾ä»£ç¢¼ç¢ºèª | `1e-4` | âš ï¸ | éœ€ç¢ºèª |

## ç™¼ç¾çš„å•é¡Œ

### âœ… å·²ä¿®æ­£å•é¡Œ

1. **æœç´¢ç¯„åœ**: âœ… å·²æ¢å¾©åˆ° Fortran åŸå§‹å€¼ `BIAS/1E6`
2. **EEP å–®ä½å› å­**: âœ… å·²ç¢ºèªæ­£ç¢º (`eep * 1e7` for surface, `eep / eps` for bulk)
3. **æ”¶æ–‚æ¢ä»¶**: âœ… å·²åŒ¹é… Fortran é‚è¼¯ (`change1 < EP`, `change2 < 2*EP`)
4. **Fermi-Dirac ç©åˆ†**: âœ… å·²å¯¦ç¾ç²¾ç¢ºæ•¸å€¼ç©åˆ†åŒ¹é… Fortran FJINT

### ğŸš¨ æ ¹æœ¬å•é¡Œ - Band Bending é‡ç´šå·®ç•°

**ç¾ç‹€**:
- Fortran: ~0.07V (70mV)  
- Python: ~0.00003V (0.03mV)
- **å·®ç•°: ç´„2300å€**

**å·²æ’é™¤çš„åŸå› **:
- âŒ æœç´¢ç¯„åœ (å·²ä¿®æ­£)
- âŒ ç‰©ç†å¸¸æ•¸ (6.815E21 æ­£ç¢º)  
- âŒ Fermiç©åˆ†ç²¾åº¦ (å·²å¯¦ç¾ç²¾ç¢ºç©åˆ†)
- âŒ æ”¶æ–‚é‚è¼¯ (å·²åŒ¹é…Fortran)
- âŒ ç¶²æ ¼åƒæ•¸ (å®Œå…¨åŒ¹é…)

### ğŸ” å¾…èª¿æŸ¥çš„å¯èƒ½åŸå› 

1. **é›»è·å¯†åº¦è¡¨æ ¼æ’å€¼æ–¹æ³•**:
   - Fortran å¯èƒ½ä½¿ç”¨ä¸åŒçš„æ’å€¼æ–¹å¼
   - éœ€è¦æª¢æŸ¥ table lookup å¯¦ç¾

2. **åˆå§‹æ¢ä»¶å·®ç•°**:
   - Fortran åˆå§‹ band bending è¨­å®š
   - å¯èƒ½çš„å‰ç½®è¨ˆç®—æ­¥é©Ÿ

3. **éš±è—çš„å–®ä½è½‰æ›**:
   - é›»ä½å–®ä½ (V vs eV)
   - é•·åº¦å–®ä½ (nm vs cm)
   - å¯†åº¦å–®ä½è½‰æ›å› å­

### âš ï¸ ä¸­å„ªå…ˆç´šå•é¡Œ

1. **Band bending è¨ˆç®—æ¬Šé‡**:
   - Fortran: `(9.*VSINT(1,I,K)-VSINT(1,I+1,K))/8.`
   - Python: å¯¦ç¾ç›¸åŒä½†éœ€è¦é©—è­‰ç´¢å¼•

2. **æ”¶æ–‚æ¨™æº–**:
   - Fortran å…·é«”æ¨™æº–éœ€è¦å¾ä»£ç¢¼ä¸­æå–
   - Python å¯èƒ½éæ–¼åš´æ ¼

## ä¸‹ä¸€æ­¥è¡Œå‹•è¨ˆåŠƒ

### ç«‹å³ä¿®æ­£ (ä»Šå¤©)
1. âœ… æ¢å¾©æœç´¢ç¯„åœåˆ° Fortran åŸå§‹å€¼
2. âœ… æª¢æŸ¥ä¸¦ä¿®æ­£ EEP å–®ä½å› å­
3. âœ… é©—è­‰ä»‹é¢é›»ä½è¨ˆç®—

### çŸ­æœŸæ”¹é€² (æœ¬é€±)
1. è©³ç´°åˆ†æ Fortran æ”¶æ–‚æ¨™æº–
2. å¯¦ç¾é›»æµè¨ˆç®—éƒ¨åˆ†
3. é©—è­‰æ‰€æœ‰æ•¸å€¼å¸¸æ•¸

### é©—è­‰æ–¹æ³•
1. é€æ­¥å°æ¯” Fortran è¼¸å‡ºçš„æ¯100æ¬¡è¿­ä»£
2. æª¢æŸ¥ä¸­é–“è®Šé‡å€¼
3. ç¢ºèªç‰©ç†å–®ä½ä¸€è‡´æ€§

---

**æ›´æ–°æ—¥æœŸ**: 2025-06-06
**ç‹€æ…‹**: åˆå§‹åˆ†æå®Œæˆï¼Œç™¼ç¾é—œéµå•é¡Œå¾…ä¿®æ­£